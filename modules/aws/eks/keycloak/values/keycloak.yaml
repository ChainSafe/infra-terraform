command:
  - "/opt/keycloak/bin/kc.sh"
  - "start"
  - "--http-port=8080"
  - "--hostname-strict=false"
  - "--hostname=https://${keycloak_dns}"

extraEnv: |
  - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
    value: "true"
  - name: KEYCLOAK_FRONTEND_URL
    value: https://${keycloak_dns}
  - name: JAVA_OPTS_APPEND
    value: >-
      -Djgroups.dns.query={{ include "keycloak.fullname" . }}-headless
  - name: KEYCLOAK_ADMIN
    value: admin
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: ${auth_secret}
        key: admin-password
# https://www.keycloak.org/server/features#_supported_features
#  - name: KC_FEATURES
#    value: account3
#  - name: KC_FEATURES_DISABLED
#    value: admin2

ingress:
  enabled: true
  ingressClassName: nginx
  servicePort: http
  annotations:
    kubernetes.io/tls-acme: "true"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  rules:
    - host: ${keycloak_dns}
      paths:
        - path: /
          pathType: Prefix
http:
  relativePath: "/"
  internalPort: http-internal
  internalScheme: HTTP

metrics:
  enabled: true
serviceMonitor:
  enabled: true

database:
  vendor: postgres
  hostname: postgresql-cluster-rw
  port: 5432
  database: app
  username: postgres
  existingSecret: ${db_secret}
  existingSecretKey: "password"
